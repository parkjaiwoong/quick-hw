# 카드 결제 프로세스 – 일반 플로우 vs 현재 구현

## 1. 서비스별 일반적인 결제 시점

### 카카오 T (택시)
- **결제 시점**: 목적지 **도착(하차) 시** 자동 결제
- **순서**: 출발지/도착지 설정 → 결제수단 사전 등록 → 호출 → 탑승 → **하차 시 자동 결제**
- 택시는 거리/시간이 변동되므로 **후결제**가 기본이고, 우리 퀵/배송과는 모델이 다름.

### 배달의민족 등 배달앱
- **선결제**: 주문 시점에 앱에서 **먼저 결제** → 결제 완료 후 배달원 배정
- **후결제**: "만나서 카드/현금 결제" 선택 시 배달원 도착 후 현장 결제
- 카드 선결제라면 보통 **「요금 확인 → 결제 → 배차」** 순서.

### 퀵서비스/배차 앱
- **선결제(카드)**: 요금 확인 후 **결제 완료** → 그다음 기사 배정/호출
- **후결제**: 현금 착불·만나서 카드 등

---

## 2. 우리 앱 현재 플로우 (기사 배정 후 결제)

```
배송 요청(주소, 금액, 결제수단 카드) 
  → 기사 추천 화면 
  → [연결 요청] 클릭 (기사 배정) 
  → 토스 결제 창 바로 오픈 
  → 결제 완료 
  → 배송 상세에서 확인
```

- **특징**: 기사를 **먼저** 연결(배정)하고, **그 다음** 카드 결제.
- **장점**: 기사가 정해진 뒤 결제하므로 "기사 없어서 취소" 상황이 적음.
- **단점**: 배달/퀵에서 흔한 **「결제 먼저 → 배차」** 패턴과는 순서가 반대.

---

## 3. 일반적인 선결제 플로우 (배달/퀵 쪽에 가까운 방식)

```
배송 요청(주소, 도착지, 금액 확인) 
  → 결제수단 카드 선택 시 
  → [결제하기] 또는 "다음" 시 토스 결제 창 오픈 
  → 결제 완료 
  → "기사 배정 중" / 기사 추천 화면 
  → 기사 선택·연결 요청 (이미 결제됨, 배정만)
  → 배송 상세에서 진행 상황 확인
```

- **특징**: **결제 먼저** → 그다음 기사 배정.
- 카카오/인성 등이 아니라, **배달·퀵 앱에서 카드 선결제할 때** 쓰는 방식에 가깝다.

---

## 4. 정리

| 구분 | 카카오 T (택시) | 배달/퀵 선결제 (일반) | 우리 앱 (현재) |
|------|-----------------|------------------------|----------------|
| 결제 시점 | 하차 시 자동 결제 | **요금 확인 후 곧바로 결제** | **기사 연결 요청 후 결제** |
| 순서 | 호출 → 탑승 → 결제 | **결제 → 배차** | **배차(연결 요청) → 결제** |

- **카카오**: 택시는 후결제(하차 시)라서, 우리처럼 “기사 배정 후 카드 결제”와는 성격이 다름.
- **인성/일반 퀵**: 카드 선결제라면 보통 **「요금 확인 → 결제 → 기사 배정」** 순서가 일반적.
- **우리**: 지금은 **「기사 연결 요청 → 결제」** 로, “기사 먼저 정해진 다음 결제”에 맞춰져 있음.

---

## 5. 선택지

- **현재 방식 유지 (기사 연결 후 결제)**  
  - 기사가 먼저 정해지고, 그다음 결제.  
  - “기사 없음”으로 인한 결제 후 취소는 적지만, 배달/퀵의 일반적인 선결제 순서와는 다름.

- **일반적인 선결제로 변경 (결제 후 기사 배정)**  
  - 배송 요청 단계에서 금액 확인 후 **토스 결제 창** 띄우기  
  - 결제 완료 후 기사 추천/연결 요청 화면으로 이동  
  - 이렇게 하면 카카오/인성이 아니라 **배달·퀵 앱의 일반적인 카드 결제 프로세스**에 맞출 수 있음.

원하시면 “결제 먼저 → 기사 배정” 순서로 플로우 변경하는 코드 위치와 수정안도 정리해 드리겠습니다.
